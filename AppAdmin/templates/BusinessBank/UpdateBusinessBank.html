{% extends "master.html" %}
{% load static %}

{% block title %}Bank Business{% endblock %}
{% block PageTitle %}Update Bank Business{% endblock %}
{% block PageHierechy %}
    <li class="breadcrumb-item tx-15"><a href="{% url 'Dashboard' %}">Purchase</a></li>
    <li class="breadcrumb-item tx-15"><a href="{% url 'Dashboard' %}">Update Business Bank</a></li>
{% endblock %}

{% block content %}
    <div class="row row-sm">
        <form class="form form-horizontal" action="" method="post" accept-charset='utf-8'
              enctype="multipart/form-data" id="BusinessForm">
            {% csrf_token %}
            <div id="info_message"></div>

            <div class="row row-sm">

                <div class="col-xl-3">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"> Location Information</div>
                        </div>
                        <div class="card-body">

                            <div class="form-group mb-0">
                                <label class="form-label">
                                    <span class="text-primary float-md-left">Location</span>
                                </label>
                                <select class="form-control" name="location" id="location">
                                    {% for data in location_store %}
                                        <option value="{{ data.loc_store_code }}"
                                                {% if business_bank.loc_store_code_id ==  data.loc_store_code %}selected="selected"{% endif %}>{{ data.loc_store_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>


                            <div class="form-group mb-0">
                                <label class="form-label">
                                    <span class="text-primary float-md-left">Address</span>
                                </label>
                                <input type="text" name="address" id="address"
                                       class="form-control" placeholder="Enter Address"
                                       value="{{ business_bank.address }}">
                            </div>
                            <div class="form-group mb-0">
                                <label class="form-label">
                                    <span class="text-primary float-md-left">Status</span>
                                </label>
                                <select name="status" id="status" class="form-control">
                                    <option value="Active">Active</option>
                                    <option value="Block">Block</option>
                                </select>
                            </div>


                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"> Geo Hierarchy</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group mb-0">
                                <label class="form-label">
                                    <label class="form-label">
                                        <span class="text-primary float-md-left">Country</span>
                                        <span class="text-secondary float-md-left">*</span>
                                        <span class="text-danger d-none float-md-left ps-lg-1"
                                              id="msg_country">Please Fill it.</span>
                                    </label>
                                </label>
                                <select id="cmd_country" name="cmd_country"
                                        class="form-control form-select select2-no-search select2-hidden-accessible">
                                    <option Value="NA">Select</option>
                                </select>
                            </div>

                            <div class="form-group mb-0">
                                <label class="form-label">
                                    <span class="text-primary float-md-left">State</span>
                                    <span class="text-secondary float-md-left">*</span>
                                    <span class="text-danger d-none float-md-left ps-lg-1"
                                          id="msg_state">Please Fill it.</span>
                                </label>

                                <select id="cmd_state" name="cmd_state"
                                        class="form-control form-select select2-no-search select2-hidden-accessible">
                                    <option Value="NA">Select</option>

                                </select>
                            </div>
                            <div class="form-group mb-0">
                                <label class="form-label">
                                    <span class="text-primary float-md-left">City</span>
                                </label>
                                <select id="cmd_city" name="cmd_city"
                                        class="form-control form-select select2-no-search select2-hidden-accessible">
                                    <option Value="NA">Select</option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="col-xl-9">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"> Detail Information</div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-xl-6 mb-0">
                                    <div class="form-group mb-0">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">COA Auto Code</span>
                                        </label>
                                        <input type="text"
                                               class="form-control" value="{{ business_bank.child_code_id }}" readonly>
                                    </div>
                                </div>
                                <div class="col-xl-6 mb-0">
                                    <div class="form-group mb-0">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">Business Bank Auto Code</span>
                                        </label>
                                        <input type="text"
                                               class="form-control" value="{{ business_bank.busi_acc_code }}" readonly>
                                    </div>
                                </div>

                                <div class="col-xl-6 mb-0">
                                    <div class="form-group mb-0">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">Account Title</span>
                                            <span class="text-secondary float-md-left">*</span>
                                            <span class="text-danger d-none float-md-left ps-lg-1"
                                                  id="msg_account_title">Please Fill it.</span>
                                        </label>
                                        <input type="text" name="account_title" id="account_title"
                                               class="form-control" placeholder="Enter Account Title"
                                               value="{{ business_bank.account_title }}">
                                    </div>
                                </div>
                                <div class="col-xl-6 mb-0">
                                    <div class="form-group mb-2">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">Account Number</span>
                                            <span class="text-secondary float-md-left">*</span>
                                            <span class="text-danger d-none float-md-left ps-lg-1"
                                                  id="msg_account_no">Please Fill it.</span>
                                        </label>
                                        <input type="text" name="account_no" id="account_no"
                                               class="form-control" placeholder="Enter Account Number"
                                               value="{{ business_bank.account_no }}">
                                    </div>
                                </div>
                                <div class="col-xl-6 mb-0">

                                    <div class="form-group mb-0">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">IBN Number</span>
                                        </label>
                                        <input type="text" name="ibn_number" id="ibn_number"
                                               class="form-control" placeholder="Enter IBN Number"
                                               value="{{ business_bank.ibn_number }}">
                                    </div>
                                </div>
                                <div class="col-xl-6 mb-0">
                                    <div class="form-group mb-0">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">Branch Code</span>
                                            <span class="text-secondary float-md-left">*</span>
                                            <span class="text-danger d-none float-md-left ps-lg-1"
                                                  id="msg_branch_code">Please Fill it.</span>
                                        </label>
                                        <input type="text" name="branch_code" id="branch_code"
                                               class="form-control" placeholder="Enter Branch Code"
                                               value="{{ business_bank.branch_code }}">
                                    </div>
                                </div>

                                <div class="col-xl-6 mb-0">
                                    <div class="form-group mb-0">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">Activation Date</span>
                                        </label>
                                        <input type="text" name="activation_date" id="activation_date"
                                               class="form-control flatpickr-input active">
                                    </div>
                                </div>
                                <div class="col-xl-6 mb-0">
                                    <div class="form-group mb-0">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">Block Date</span>
                                        </label>
                                        <input type="text" name="block_date" id="block_date"
                                               class="form-control flatpickr-input active">
                                    </div>
                                </div>

                                <div class="col-xl-12 mb-0">
                                    <div class="form-group mb-0">
                                        <label class="form-label">
                                            <span class="text-primary float-md-left">Description</span>
                                        </label>
                                        <textarea rows="2" name="description" id="description"
                                                  class="form-control"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer ">
                            <button class="btn btn-primary px-5 w-100" type="button" id="submitBtn">
                                Update Bank Business
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

{% endblock %}

{% block js %}
    <script src="{% static "AppAdmin.js" %}" type="text/javascript"></script>
    <script>
        let AdmineModelJS = null;
        var message = '{{ message }}';
        let get_all_country = '{% url "GetAllCountry" %}'

        $('#status').val('{{ business_bank.status }}');
        $('#description').val('{{ business_bank.description }}');
        $('#block_date').val('{{ business_bank.block_date }}');
        $('#activation_date').val('{{ business_bank.activation_date }}');
        let country = '{{ business_bank.country }}';
        let state = '{{ business_bank.state }}';
        let city = '{{ business_bank.city }}';


        $(document).ready(function () {
            AdmineModelJS = new AppAdminModel();
            AdmineModelJS.appConstructor();

            GlobalModelJS.GetAllCountry("cmd_country", country);
            $("#cmd_country").change(function (e) {
                var selected_value = e.target.value;
                let condition_column = "country_code=" + selected_value;
                let cmd_column = "state_code^^state_name";
                GlobalModelJS.FillCmdListByModelWithCode("tbl_state_data", condition_column, cmd_column, "cmd_state", state);
            });
            //ONCHANGE FUNCTION THAT SHOW CITY FROM THE SELECTED STATE
            $("#cmd_state").change(function (e) {
                var selected_value = e.target.value;
                let condition_column = "state_code=" + selected_value;
                let cmd_column = "city_code^^city_name";
                GlobalModelJS.FillCmdListByModelWithCode("tbl_city_data", condition_column, cmd_column, "cmd_city", city);
            });

            $("#submitBtn").click(function () {
                let Status = 0;
                let get_country = $("#cmd_country").val();
                if (get_country === "NA") {
                    $("#msg_country").removeClass("d-none");
                    $("#msg_country").addClass("d-block");
                    Status = 1;
                } else {
                    $("#msg_country").removeClass("d-block");
                    $("#msg_country").addClass("d-none");
                }

                let get_state = $("#cmd_state").val();
                if (get_state === "NA") {
                    $("#msg_state").removeClass("d-none");
                    $("#msg_state").addClass("d-block");
                    Status = 1;
                } else {
                    $("#msg_state").removeClass("d-block");
                    $("#msg_state").addClass("d-none");
                }
                let get_account_title = $("#account_title").val();
                if (get_account_title === "") {
                    $("#msg_account_title").removeClass("d-none");
                    $("#msg_account_title").addClass("d-block");
                    Status = 1;
                } else {
                    $("#msg_account_title").removeClass("d-block");
                    $("#msg_account_title").addClass("d-none");
                }


                let get_account_no = $("#account_no").val();
                if (get_account_no === "") {
                    $("#msg_account_no").removeClass("d-none");
                    $("#msg_account_no").addClass("d-block");
                    Status = 1;
                } else {
                    $("#msg_account_no").removeClass("d-block");
                    $("#msg_account_no").addClass("d-none");
                }

                let get_branch_code = $("#branch_code").val();
                if (get_branch_code === "") {
                    $("#msg_branch_code").removeClass("d-none");
                    $("#msg_branch_code").addClass("d-block");
                    Status = 1;
                } else {
                    $("#msg_branch_code").removeClass("d-block");
                    $("#msg_branch_code").addClass("d-none");
                }


                if (Status === 0) {
                    $("#BusinessForm").submit(); // Submit the form
                }
            });
        });


        if (message === "Success") {
            successAvatarBox("info_message", "Business Bank Created!!!");
        }


        $("#location").select2();
        $("#status").select2();
        $('#cmd_country').select2();
        $('#cmd_state').select2();
        $('#cmd_city').select2();

        flatpickr("#block_date", {});
        flatpickr("#activation_date", {});


    </script>
{% endblock %}
